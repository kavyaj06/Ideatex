<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta content="width=device-width, initial-scale=1.0" name="viewport" />
    <title>AI Resume Analysis - CampusAI</title>
    <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
    <link href="https://fonts.googleapis.com/css2?family=Lexend:wght@300;400;500;600;700&amp;display=swap"
        rel="stylesheet" />
    <link
        href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&amp;display=swap"
        rel="stylesheet" />
    <script id="tailwind-config">
        tailwind.config = {
            darkMode: "class",
            theme: {
                extend: {
                    colors: {
                        primary: "#7C3AED", // Purple theme
                        secondary: "#F5F3FF",
                        accent: "#6D28D9",
                        "background-light": "#FAFAFA",
                    },
                    fontFamily: {
                        display: "Lexend",
                    },
                    borderRadius: {
                        DEFAULT: "0.5rem",
                        lg: "0.75rem",
                        xl: "1rem",
                        full: "9999px"
                    }
                }
            }
        };
    </script>
    <style type="text/tailwindcss">
        body {
            font-family: 'Lexend', sans-serif;
        }
        .circular-progress-ring {
            background: conic-gradient(var(--primary-color) 295.2deg, #F1F5F9 0);
            mask: radial-gradient(transparent 65%, black 66%);
            -webkit-mask: radial-gradient(transparent 65%, black 66%);
        }.gauge-container {
            position: relative;
            width: 200px;
            height: 200px;
        }
        .gauge-svg {
            transform: rotate(-90deg);
        }
        .gauge-bg {
            fill: none;
            stroke: #F1F5F9;
            stroke-width: 12;
        }
        .gauge-progress {
            fill: none;
            stroke: #7C3AED;
            stroke-width: 12;
            stroke-linecap: round;
            stroke-dasharray: 452;stroke-dashoffset: 81;transition: stroke-dashoffset 1s ease-out;
        }
        :root {
            --primary-color: #7C3AED;
        }
    </style>
</head>

<body class="bg-background-light text-slate-900 min-h-screen flex flex-col">
    <header class="w-full border-b border-slate-200 px-6 lg:px-20 py-3 bg-white sticky top-0 z-50">
        <div class="max-w-[1400px] mx-auto flex items-center justify-between">
            <div class="flex items-center gap-4">
                <div class="text-primary">
                    <svg class="size-8" fill="none" viewBox="0 0 48 48" xmlns="http://www.w3.org/2000/svg">
                        <path clip-rule="evenodd" d="M24 4H6V17.3333V30.6667H24V44H42V30.6667V17.3333H24V4Z"
                            fill="currentColor" fill-rule="evenodd"></path>
                    </svg>
                </div>
                <h2 class="text-xl font-bold leading-tight tracking-tight text-slate-800">CampusAI</h2>
            </div>
            <div class="flex items-center gap-8">
                <nav class="hidden md:flex items-center gap-8">
                    <a class="text-sm font-medium text-slate-500 hover:text-primary transition-colors"
                        href="#">Dashboard</a>
                    <a class="text-sm font-medium text-slate-500 hover:text-primary transition-colors"
                        href="#">Profile</a>
                    <a class="text-sm font-medium text-primary relative after:content-[''] after:absolute after:-bottom-[19px] after:left-0 after:w-full after:h-0.5 after:bg-primary"
                        href="#">Resume</a>
                    <a class="text-sm font-medium text-slate-500 hover:text-primary transition-colors"
                        href="#">Screening</a>
                    <a class="text-sm font-medium text-slate-500 hover:text-primary transition-colors"
                        href="#">Results</a>
                    <a class="text-sm font-medium text-slate-500 hover:text-primary transition-colors"
                        href="#">Progress</a>
                    <a class="text-sm font-medium text-slate-500 hover:text-primary transition-colors" href="#">News</a>
                </nav>
                <div class="flex items-center gap-6">
                    <button
                        class="text-sm font-medium text-slate-500 hover:text-red-500 transition-colors">Logout</button>
                    <div
                        class="h-9 w-9 rounded-full bg-primary/10 flex items-center justify-center text-primary font-bold text-sm border border-primary/20 shadow-sm">
                        JD</div>
                </div>
            </div>
        </div>
    </header>
    <main class="flex-grow max-w-[1400px] mx-auto w-full px-6 py-8">
        <div class="flex flex-col md:flex-row md:items-end justify-between mb-8 gap-4">
            <div>
                <nav class="flex items-center gap-2 text-sm text-slate-400 mb-2 font-medium">
                    <span>Applications</span>
                    <span class="material-symbols-outlined text-[16px]">chevron_right</span>
                    <span class="text-primary">Resume Analysis</span>
                </nav>
                <h1 class="text-3xl font-bold text-slate-900">AI Resume Insights</h1>
                <p class="text-slate-500 mt-1">Detailed analysis of your resume for "Senior Software Engineer" role.</p>
            </div>
            <div class="flex gap-3">
                <label for="pdfUpload"
                    class="flex items-center gap-2 px-5 py-2.5 border border-slate-200 rounded-lg text-sm font-semibold hover:bg-slate-50 transition-all text-slate-700 bg-white cursor-pointer">
                    <span class="material-symbols-outlined text-[20px]">upload_file</span>
                    Import PDF
                </label>
                <input type="file" id="pdfUpload" accept=".pdf" class="hidden" onchange="handlePdfUpload(event)">
                <button
                    class="flex items-center gap-2 px-5 py-2.5 bg-primary text-white rounded-lg text-sm font-bold hover:bg-accent transition-all shadow-sm">
                    <span class="material-symbols-outlined text-[20px]">refresh</span>
                    Re-scan Resume
                </button>
            </div>
        </div>
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            <div class="lg:col-span-1 space-y-6">
                <div class="bg-white rounded-xl p-8 border border-slate-200 shadow-sm flex flex-col items-center">
                    <h3 class="text-lg font-bold text-primary mb-6 self-start">Overall Match Score</h3>
                    <div class="gauge-container flex items-center justify-center">
                        <svg class="gauge-svg w-full h-full" viewBox="0 0 160 160">
                            <circle class="gauge-bg" cx="80" cy="80" r="72"></circle>
                            <circle class="gauge-progress" cx="80" cy="80" r="72" style="stroke-dashoffset: 81;">
                            </circle>
                        </svg>
                        <div class="absolute flex flex-col items-center justify-center">
                            <span class="text-5xl font-bold text-slate-800">82<span
                                    class="text-2xl text-slate-400">%</span></span>
                            <span class="text-xs font-semibold text-emerald-500 flex items-center gap-1 mt-1">
                                <span class="material-symbols-outlined text-sm">trending_up</span>
                                +5% gain
                            </span>
                        </div>
                    </div>
                    <div class="mt-8 grid grid-cols-2 gap-4 w-full">
                        <div class="text-center p-3 rounded-lg bg-slate-50 border border-slate-100">
                            <p class="text-[10px] text-slate-400 uppercase tracking-widest font-bold mb-1">Readability
                            </p>
                            <p class="text-base font-bold text-slate-700">Excellent</p>
                        </div>
                        <div class="text-center p-3 rounded-lg bg-slate-50 border border-slate-100">
                            <p class="text-[10px] text-slate-400 uppercase tracking-widest font-bold mb-1">ATS Friendly
                            </p>
                            <p class="text-base font-bold text-slate-700">Yes</p>
                        </div>
                    </div>
                </div>
                <div class="bg-white rounded-xl p-6 border border-slate-200 shadow-sm">
                    <h3 class="text-lg font-bold text-primary mb-5">Skill Gap Analysis</h3>
                    <div class="space-y-6">
                        <div>
                            <div class="flex justify-between text-sm mb-2">
                                <span class="font-semibold text-slate-700">Frontend (React, Tailwind)</span>
                                <span class="text-primary font-bold">95%</span>
                            </div>
                            <div class="h-1.5 w-full bg-slate-100 rounded-full overflow-hidden">
                                <div class="h-full bg-primary rounded-full transition-all duration-500"
                                    style="width: 95%"></div>
                            </div>
                        </div>
                        <div>
                            <div class="flex justify-between text-sm mb-2">
                                <span class="font-semibold text-slate-700">Backend (Node.js, SQL)</span>
                                <span class="text-primary font-bold">70%</span>
                            </div>
                            <div class="h-1.5 w-full bg-slate-100 rounded-full overflow-hidden">
                                <div class="h-full bg-primary rounded-full transition-all duration-500"
                                    style="width: 70%"></div>
                            </div>
                        </div>
                        <div>
                            <div class="flex justify-between text-sm mb-2">
                                <span class="font-semibold text-slate-700">System Design</span>
                                <span class="text-primary font-bold">45%</span>
                            </div>
                            <div class="h-1.5 w-full bg-slate-100 rounded-full overflow-hidden">
                                <div class="h-full bg-primary rounded-full transition-all duration-500"
                                    style="width: 45%"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="lg:col-span-2 space-y-6">
                <div class="bg-white rounded-xl p-6 border border-slate-200 shadow-sm">
                    <h3 class="text-lg font-bold text-primary mb-4 flex items-center gap-2">
                        <span class="material-symbols-outlined text-primary">auto_awesome</span>
                        AI Feedback Highlights
                    </h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div class="p-4 bg-secondary rounded-lg border border-primary/10">
                            <div class="flex items-start gap-3">
                                <span
                                    class="material-symbols-outlined text-primary text-[20px] mt-0.5">check_circle</span>
                                <div>
                                    <h4 class="font-bold text-sm text-slate-800">Impactful Phrasing</h4>
                                    <p class="text-xs leading-relaxed text-slate-600 mt-1">Excellent use of action verbs
                                        like "spearheaded" and "orchestrated" in work history.</p>
                                </div>
                            </div>
                        </div>
                        <div class="p-4 bg-secondary rounded-lg border border-primary/10">
                            <div class="flex items-start gap-3">
                                <span class="material-symbols-outlined text-primary text-[20px] mt-0.5">info</span>
                                <div>
                                    <h4 class="font-bold text-sm text-slate-800">Quantify Results</h4>
                                    <p class="text-xs leading-relaxed text-slate-600 mt-1">Your 'Project X' section
                                        lacks metrics. Consider adding percentage improvements.</p>
                                </div>
                            </div>
                        </div>
                        <div class="p-4 bg-secondary rounded-lg border border-primary/10">
                            <div class="flex items-start gap-3">
                                <span class="material-symbols-outlined text-primary text-[20px] mt-0.5">warning</span>
                                <div>
                                    <h4 class="font-bold text-sm text-slate-800">Missing Keywords</h4>
                                    <p class="text-xs leading-relaxed text-slate-600 mt-1">Keywords like "Kubernetes"
                                        and "Microservices" are missing from your profile.</p>
                                </div>
                            </div>
                        </div>
                        <div class="p-4 bg-secondary rounded-lg border border-primary/10">
                            <div class="flex items-start gap-3">
                                <span class="material-symbols-outlined text-primary text-[20px] mt-0.5">lightbulb</span>
                                <div>
                                    <h4 class="font-bold text-sm text-slate-800">Career Trajectory</h4>
                                    <p class="text-xs leading-relaxed text-slate-600 mt-1">Your experience shows a
                                        strong progression toward leadership roles.</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="bg-white rounded-xl border border-slate-200 shadow-sm overflow-hidden">
                    <div class="p-6 border-b border-slate-100">
                        <h3 class="text-lg font-bold text-primary">Critical Improvements</h3>
                    </div>
                    <div class="divide-y divide-slate-100">
                        <div class="p-6 flex gap-6">
                            <div
                                class="hidden sm:flex flex-shrink-0 w-12 h-12 bg-red-50 rounded-full items-center justify-center text-red-500 font-bold border border-red-100 text-sm">
                                01
                            </div>
                            <div class="flex-grow">
                                <h4 class="font-bold text-slate-800 mb-2">Enhance the 'Education' Section</h4>
                                <p class="text-slate-600 text-sm mb-4 leading-relaxed">
                                    The current layout for your academic history is slightly cluttered. Use bullet
                                    points to highlight relevant coursework and academic honors.
                                </p>
                                <div
                                    class="bg-slate-50 border border-slate-200 p-3 rounded text-xs font-mono text-slate-500 italic">
                                    "B.S. in Computer Science, University of Technology, 2020. GPA: 3.8/4.0. Relevant:
                                    Algorithms, OS."
                                </div>
                            </div>
                        </div>
                        <div class="p-6 flex gap-6">
                            <div
                                class="hidden sm:flex flex-shrink-0 w-12 h-12 bg-amber-50 rounded-full items-center justify-center text-amber-500 font-bold border border-amber-100 text-sm">
                                02
                            </div>
                            <div class="flex-grow">
                                <h4 class="font-bold text-slate-800 mb-2">Professional Summary</h4>
                                <p class="text-slate-600 text-sm mb-4 leading-relaxed">
                                    Your summary is currently too generic. Tailor it to the "Senior" role by emphasizing
                                    your 5+ years of experience in architectural decisions.
                                </p>
                                <div class="flex flex-wrap gap-2">
                                    <span
                                        class="px-3 py-1 bg-primary/10 text-primary text-[10px] font-bold rounded-full">Suggested
                                        Edit</span>
                                    <span
                                        class="px-3 py-1 bg-slate-100 text-slate-500 text-[10px] font-bold rounded-full">Architecture</span>
                                    <span
                                        class="px-3 py-1 bg-slate-100 text-slate-500 text-[10px] font-bold rounded-full">Leadership</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>
    <footer class="w-full py-8 mt-12">
        <div class="max-w-[1400px] mx-auto px-6 flex justify-center">
            <p class="text-[11px] text-slate-400 font-medium">¬© 2024 AI-driven career guidance.</p>
        </div>
    </footer>

    <script src="api.js"></script>
    <script src="nav.js"></script>
    <script>
        let currentResumeData = null;

        async function loadResumeData() {
            const user = JSON.parse(localStorage.getItem('user'));
            if (!user) return;

            try {
                const profile = await api.getStudentProfile(user._id);
                if (profile && profile.resumeScore) {
                    updateResumeUI(profile.resumeScore, profile.resumeFeedback || "Analysis complete");
                }
            } catch (err) {
                console.error(err);
            }
        }

        function updateResumeUI(scoreVal, feedback) {
            // Update Gauge
            const scoreText = document.querySelector('.text-5xl.font-bold');
            if (scoreText) scoreText.innerHTML = `${scoreVal}<span class="text-2xl text-slate-400">%</span>`;

            const gaugeProgress = document.querySelector('.gauge-progress');
            if (gaugeProgress) {
                const offset = 452 * (1 - scoreVal / 100);
                gaugeProgress.style.strokeDashoffset = offset;
            }
        }

        // Handle PDF Upload
        async function handlePdfUpload(event) {
            const file = event.target.files[0];
            if (!file || file.type !== 'application/pdf') {
                alert('Please upload a valid PDF file');
                return;
            }

            const uploadBtn = document.querySelector('label[for="pdfUpload"]');
            const originalText = uploadBtn.innerHTML;
            uploadBtn.innerHTML = '<span class="material-symbols-outlined text-[20px]">hourglass_empty</span> Analyzing...';
            uploadBtn.disabled = true;

            try {
                const formData = new FormData();
                formData.append('resume', file);

                const response = await fetch('/api/resume/analyze', {
                    method: 'POST',
                    body: formData
                });

                if (!response.ok) {
                    const error = await response.json();
                    throw new Error(error.error || 'Upload failed');
                }

                const result = await response.json();
                
                console.log('üìä API Response:', result);
                
                if (result.success && result.data) {
                    currentResumeData = result.data;
                    console.log('üìã Analysis Data:', result.data);
                    displayAnalysisResults(result.data);
                    console.log('‚úÖ Display function called');
                    alert('Resume analyzed successfully!');
                } else {
                    console.error('‚ùå Invalid result:', result);
                    alert('Analysis incomplete. Please try again.');
                }
            } catch (err) {
                console.error('Error uploading PDF:', err);
                alert('Error: ' + err.message);
            } finally {
                uploadBtn.innerHTML = originalText;
                uploadBtn.disabled = false;
            }
        }

        function displayAnalysisResults(analysis) {
            console.log('üìä Displaying analysis results:', analysis);
            
            // Update Overall Score
            if (analysis.overallScore !== undefined) {
                const scoreText = document.querySelector('.text-5xl.font-bold');
                console.log('Score element found:', scoreText);
                if (scoreText) {
                    scoreText.innerHTML = `${analysis.overallScore}<span class="text-2xl text-slate-400">%</span>`;
                    const gaugeProgress = document.querySelector('.gauge-progress');
                    if (gaugeProgress) {
                        const offset = 452 * (1 - analysis.overallScore / 100);
                        gaugeProgress.style.strokeDashoffset = offset;
                    }
                    console.log('‚úÖ Score updated:', analysis.overallScore);
                } else {
                    console.error('‚ùå Score element not found');
                }
            }

            // Update Skill Gaps
            if (analysis.skillGaps && analysis.skillGaps.length > 0) {
                const headings = Array.from(document.querySelectorAll('h3'));
                console.log('Found headings:', headings.map(h => h.textContent.trim()));
                const skillGapHeading = headings.find(h => h.textContent.includes('Skill Gap Analysis'));
                console.log('Skill Gap heading:', skillGapHeading);
                const skillGapsContainer = skillGapHeading?.nextElementSibling;
                console.log('Skills container:', skillGapsContainer);
                
                if (skillGapsContainer) {
                    skillGapsContainer.innerHTML = analysis.skillGaps.map(skill => `
                        <div>
                            <div class="flex justify-between text-sm mb-2">
                                <span class="font-semibold text-slate-700">${skill.skill}</span>
                                <span class="text-primary font-bold">${skill.match}%</span>
                            </div>
                            <div class="h-1.5 w-full bg-slate-100 rounded-full overflow-hidden">
                                <div class="h-full bg-primary rounded-full transition-all duration-500" style="width: ${skill.match}%"></div>
                            </div>
                        </div>
                    `).join('');
                    console.log('‚úÖ Skill gaps updated:', analysis.skillGaps.length, 'items');
                    // Scroll to skill gaps
                    skillGapsContainer.parentElement.scrollIntoView({ behavior: 'smooth', block: 'center' });
                } else {
                    console.error('‚ùå Skill gaps container not found');
                }
            }

            // Update Feedback Highlights
            if (analysis.feedback && analysis.feedback.length > 0) {
                const headings = Array.from(document.querySelectorAll('h3'));
                const feedbackHeading = headings.find(h => h.textContent.includes('AI Feedback Highlights'));
                console.log('Feedback heading:', feedbackHeading);
                const feedbackContainer = feedbackHeading?.closest('.bg-white')?.querySelector('.grid');
                console.log('Feedback container:', feedbackContainer);
                
                if (feedbackContainer) {
                    feedbackContainer.innerHTML = analysis.feedback.slice(0, 4).map(item => {
                        const icons = {
                            'positive': 'check_circle',
                            'warning': 'warning',
                            'improvement': 'lightbulb'
                        };
                        const colors = {
                            'positive': 'text-emerald-500',
                            'warning': 'text-amber-500',
                            'improvement': 'text-blue-500'
                        };
                        return `
                            <div class="p-4 bg-secondary rounded-lg border border-primary/10">
                                <div class="flex items-start gap-3">
                                    <span class="material-symbols-outlined ${colors[item.type] || 'text-primary'} text-[20px] mt-0.5">${icons[item.type] || 'info'}</span>
                                    <div>
                                        <h4 class="font-bold text-sm text-slate-800">${item.title}</h4>
                                        <p class="text-xs leading-relaxed text-slate-600 mt-1">${item.description}</p>
                                    </div>
                                </div>
                            </div>
                        `;
                    }).join('');
                    console.log('‚úÖ Feedback updated:', analysis.feedback.length, 'items');
                } else {
                    console.error('‚ùå Feedback container not found');
                }
            }

            // Update Critical Improvements
            if (analysis.criticalImprovements && analysis.criticalImprovements.length > 0) {
                const headings = Array.from(document.querySelectorAll('h3'));
                const improvementsHeading = headings.find(h => h.textContent.includes('Critical Improvements'));
                console.log('Improvements heading:', improvementsHeading);
                const improvementsContainer = improvementsHeading?.closest('.bg-white')?.querySelector('.divide-y');
                console.log('Improvements container:', improvementsContainer);
                
                if (improvementsContainer) {
                    improvementsContainer.innerHTML = analysis.criticalImprovements.map(imp => {
                        const colors = ['red', 'amber', 'orange'];
                        const color = colors[imp.number - 1] || 'slate';
                        return `
                            <div class="p-6 flex gap-6">
                                <div class="hidden sm:flex flex-shrink-0 w-12 h-12 bg-${color}-50 rounded-full items-center justify-center text-${color}-500 font-bold border border-${color}-100 text-sm">
                                    ${String(imp.number).padStart(2, '0')}
                                </div>
                                <div class="flex-grow">
                                    <h4 class="font-bold text-slate-800 mb-2">${imp.title}</h4>
                                    <p class="text-slate-600 text-sm mb-4 leading-relaxed">${imp.description}</p>
                                    <div class="bg-slate-50 border border-slate-200 p-3 rounded text-xs font-mono text-slate-500 italic">
                                        "${imp.suggestedEdit}"
                                    </div>
                                </div>
                            </div>
                        `;
                    }).join('');
                    console.log('‚úÖ Improvements updated:', analysis.criticalImprovements.length, 'items');
                } else {
                    console.error('‚ùå Improvements container not found');
                }
            }
            
            console.log('üéâ All updates complete!');
        }
        
        loadResumeData();
    </script>
</body>

</html>
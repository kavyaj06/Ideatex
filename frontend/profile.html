<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta content="width=device-width, initial-scale=1.0" name="viewport" />
    <title>Placement AI - Student Profile</title>
    <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
    <link href="https://fonts.googleapis.com/css2?family=Lexend:wght@100..900&amp;display=swap" rel="stylesheet" />
    <link
        href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&amp;display=swap"
        rel="stylesheet" />
    <script id="tailwind-config">
        tailwind.config = {
            darkMode: "class",
            theme: {
                extend: {
                    colors: {
                        "primary": "#7c3aed",
                        "primary-light": "#f5f3ff",
                        "background-light": "#fbfbfe",
                        "background-dark": "#0f172a",
                        "accent-green": "#10b981",
                    },
                    fontFamily: {
                        "display": ["Lexend", "sans-serif"]
                    },
                    borderRadius: {
                        "DEFAULT": "0.25rem",
                        "lg": "0.5rem",
                        "xl": "0.75rem",
                        "2xl": "1rem",
                        "full": "9999px"
                    },
                },
            },
        }
    </script>
    <style type="text/tailwindcss">
        .material-symbols-outlined {
            font-variation-settings: 'FILL' 0, 'wght' 400, 'GRAD' 0, 'opsz' 24;
        }
        @layer utilities {
            .nav-link-active {
                @apply text-primary border-b-2 border-primary;
            }
        }
    </style>
</head>

<body class="bg-background-light dark:bg-background-dark font-display text-slate-900 dark:text-white min-h-screen">
    <nav class="sticky top-0 z-50 bg-white dark:bg-[#111418] border-b border-slate-200 dark:border-slate-800">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between h-16">
                <div class="flex items-center gap-3">
                    <div
                        class="size-9 bg-primary rounded-lg flex items-center justify-center text-white shadow-lg shadow-primary/20">
                        <span class="material-symbols-outlined text-[20px]">rocket_launch</span>
                    </div>
                    <div>
                        <h1 class="text-lg font-bold leading-none tracking-tight">Placement AI</h1>
                    </div>
                </div>
                <div class="hidden md:flex items-center space-x-1">
                    <a class="px-4 h-16 flex items-center text-sm font-medium text-slate-500 hover:text-primary transition-colors"
                        href="#">Dashboard</a>
                    <a class="px-4 h-16 flex items-center text-sm font-semibold nav-link-active" href="#">Profile</a>
                    <a class="px-4 h-16 flex items-center text-sm font-medium text-slate-500 hover:text-primary transition-colors"
                        href="#">Resume</a>
                    <a class="px-4 h-16 flex items-center text-sm font-medium text-slate-500 hover:text-primary transition-colors"
                        href="#">Screening</a>
                    <a class="px-4 h-16 flex items-center text-sm font-medium text-slate-500 hover:text-primary transition-colors"
                        href="#">Results</a>
                    <a class="px-4 h-16 flex items-center text-sm font-medium text-slate-500 hover:text-primary transition-colors"
                        href="#">Progress</a>
                    <a class="px-4 h-16 flex items-center text-sm font-medium text-slate-500 hover:text-primary transition-colors"
                        href="#">News</a>
                </div>
                <div class="flex items-center">
                    <button
                        class="px-5 py-2 text-sm font-bold text-primary border-2 border-primary rounded-xl hover:bg-primary hover:text-white transition-all">
                        Logout
                    </button>
                </div>
            </div>
        </div>
    </nav>
    <div class="w-full bg-white dark:bg-[#111418] border-b border-slate-200 dark:border-slate-800 py-3">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex items-center justify-between gap-6">
                <div class="flex items-center gap-3 shrink-0">
                    <span class="material-symbols-outlined text-primary">bolt</span>
                    <span class="text-sm font-bold text-slate-700 dark:text-slate-300">Profile Completeness</span>
                </div>
                <div class="flex-1 max-w-2xl bg-slate-100 dark:bg-slate-800 h-2 rounded-full overflow-hidden">
                    <div class="bg-primary h-full rounded-full" style="width: 85%;"></div>
                </div>
                <span class="text-sm font-bold text-primary shrink-0">85%</span>
            </div>
        </div>
    </div>
    <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        <div class="flex flex-col lg:flex-row gap-6 items-start">
            <div class="w-full lg:w-2/3 space-y-6">
                <div
                    class="bg-white dark:bg-[#111418] border border-slate-200 dark:border-slate-800 rounded-2xl p-8 shadow-sm">
                    <div class="flex flex-col md:flex-row items-center gap-6">
                        <div class="relative">
                            <div id="profile-initial-container"
                                class="size-24 md:size-32 rounded-full border-4 border-primary/10 bg-primary/10 flex items-center justify-center">
                                <span id="profile-initial" class="text-4xl md:text-5xl font-bold text-primary">A</span>
                            </div>
                            <div
                                class="absolute bottom-1 right-1 size-5 bg-accent-green border-4 border-white dark:border-[#111418] rounded-full">
                            </div>
                        </div>
                        <div class="text-center md:text-left flex-1">
                            <div class="flex flex-col md:flex-row md:items-center justify-between gap-4">
                                <div>
                                    <h2 class="text-3xl font-black text-slate-900 dark:text-white">Alex Rivera</h2>
                                    <p class="text-slate-500 dark:text-slate-400 font-medium">B.Tech in Computer Science
                                        | Class of 2024</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div
                    class="bg-white dark:bg-[#111418] border border-slate-200 dark:border-slate-800 rounded-2xl p-8 shadow-sm">
                    <div class="flex items-center justify-between mb-6">
                        <h3 class="text-lg font-bold text-slate-900 dark:text-white">Personal Information</h3>
                        <button id="manage-btn" class="text-primary text-sm font-bold hover:underline">Manage</button>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                        <div>
                            <p class="text-[10px] text-slate-400 uppercase tracking-widest font-black mb-1">Email</p>
                            <p class="font-medium text-slate-700 dark:text-slate-300">alex.rivera@university.edu</p>
                        </div>
                        <div>
                            <p class="text-[10px] text-slate-400 uppercase tracking-widest font-black mb-1">Phone</p>
                            <p class="font-medium text-slate-700 dark:text-slate-300">+1 (555) 0123</p>
                        </div>
                        <div>
                            <p class="text-[10px] text-slate-400 uppercase tracking-widest font-black mb-1">LinkedIn</p>
                            <a class="font-medium text-primary flex items-center gap-1 hover:underline" href="#">
                                linkedin.com/in/alexrivera <span
                                    class="material-symbols-outlined text-xs">open_in_new</span>
                            </a>
                        </div>
                        <div>
                            <p class="text-[10px] text-slate-400 uppercase tracking-widest font-black mb-1">Portfolio
                            </p>
                            <a class="font-medium text-primary flex items-center gap-1 hover:underline" href="#">
                                alexrivera.dev <span class="material-symbols-outlined text-xs">open_in_new</span>
                            </a>
                        </div>
                    </div>
                </div>
                <div
                    class="bg-white dark:bg-[#111418] border border-slate-200 dark:border-slate-800 rounded-2xl p-8 shadow-sm">
                    <div class="flex items-center justify-between mb-6">
                        <h3 class="text-lg font-bold text-slate-900 dark:text-white">Featured Projects</h3>
                        <button id="add-project-btn"
                            class="text-primary text-sm font-bold flex items-center gap-1 hover:underline">
                            <span class="material-symbols-outlined text-[18px]">add</span> Add New
                        </button>
                    </div>
                    <div id="projects-container">
                        <!-- Projects will be loaded here -->
                        <p class="text-slate-500 text-sm italic p-4">Loading projects...</p>
                    </div>
                </div>
            </div>
            <div class="w-full lg:w-1/3 space-y-6">
                <div
                    class="bg-white dark:bg-[#111418] border border-slate-200 dark:border-slate-800 rounded-2xl p-8 shadow-sm">
                    <h3 class="text-lg font-bold text-slate-900 dark:text-white mb-6">Academic Standing</h3>
                    <div class="flex flex-col items-center justify-center">
                        <div class="relative flex items-center justify-center">
                            <svg class="size-40 transform -rotate-90">
                                <circle class="text-slate-100 dark:text-slate-800" cx="80" cy="80" fill="transparent"
                                    r="70" stroke="currentColor" stroke-width="10"></circle>
                                <circle class="text-primary" cx="80" cy="80" fill="transparent" r="70"
                                    stroke="currentColor" stroke-dasharray="440" stroke-dashoffset="48.4"
                                    stroke-linecap="round" stroke-width="10"></circle>
                            </svg>
                            <div class="absolute inset-0 flex flex-col items-center justify-center">
                                <p class="text-4xl font-black text-primary leading-none">8.9</p>
                                <p class="text-[10px] text-slate-400 font-bold mt-1 uppercase tracking-widest">CGPA</p>
                            </div>
                        </div>
                        <div class="mt-4 text-center">
                            <p class="text-xs text-slate-500 font-medium">Standard Scale of 10.00</p>
                            <p class="text-[10px] text-slate-400 mt-0.5 italic">Last updated: May 2024</p>
                        </div>
                    </div>
                </div>
                <div
                    class="bg-white dark:bg-[#111418] border border-slate-200 dark:border-slate-800 rounded-2xl p-8 shadow-sm">
                    <h3 class="text-lg font-bold text-slate-900 dark:text-white mb-6">Technical Skills</h3>
                    <div class="flex flex-wrap gap-2 mb-6">
                        <span
                            class="px-3 py-1.5 bg-primary/10 text-primary border border-primary/20 rounded-lg text-xs font-bold">Java</span>
                        <span
                            class="px-3 py-1.5 bg-primary/10 text-primary border border-primary/20 rounded-lg text-xs font-bold">Python</span>
                        <span
                            class="px-3 py-1.5 bg-primary/10 text-primary border border-primary/20 rounded-lg text-xs font-bold">Machine
                            Learning</span>
                        <span
                            class="px-3 py-1.5 bg-primary/10 text-primary border border-primary/20 rounded-lg text-xs font-bold">C++</span>
                        <span
                            class="px-3 py-1.5 bg-primary/10 text-primary border border-primary/20 rounded-lg text-xs font-bold">React</span>
                        <span
                            class="px-3 py-1.5 bg-primary/10 text-primary border border-primary/20 rounded-lg text-xs font-bold">SQL</span>
                        <span
                            class="px-3 py-1.5 bg-primary/10 text-primary border border-primary/20 rounded-lg text-xs font-bold">Docker</span>
                    </div>
                    <div class="flex gap-3">
                        <button id="btn-add-skill"
                            class="flex-1 py-2 border-2 border-dashed border-slate-200 dark:border-slate-800 rounded-xl text-slate-400 text-xs font-bold hover:border-primary hover:text-primary transition-all">
                            + Add Skill
                        </button>
                        <button onclick="openManageSkills()"
                            class="px-4 py-2 border-2 border-slate-200 dark:border-slate-800 rounded-xl text-slate-500 text-xs font-bold hover:border-slate-400 hover:text-slate-700 transition-all flex items-center justify-center gap-1">
                            <span class="material-symbols-outlined text-[16px]">settings</span> Manage
                        </button>
                    </div>
                </div>
            </div>
        </div>
        <!-- Manage Profile Modal -->
        <div id="modal-manage-info"
            class="hidden fixed inset-0 z-[100] flex items-center justify-center p-4 bg-slate-900/60 backdrop-blur-sm">
            <div
                class="bg-white dark:bg-[#111418] w-full max-w-lg rounded-2xl overflow-hidden shadow-2xl border border-slate-200 dark:border-slate-800">
                <div class="bg-primary px-8 py-6 flex items-center justify-between">
                    <h2 class="text-xl font-bold text-white">Manage Personal Information</h2>
                    <button onclick="closeModal('modal-manage-info')" type="button"
                        class="text-white/80 hover:text-white transition-colors">
                        <span class="material-symbols-outlined">close</span>
                    </button>
                </div>
                <div class="p-8">
                    <form id="form-manage-info" class="space-y-5" onsubmit="handleSaveInfo(event)">
                        <div>
                            <label class="block text-xs font-black uppercase tracking-widest text-slate-400 mb-2">Full
                                Name</label>
                            <input id="info-name"
                                class="w-full px-4 py-2.5 bg-slate-50 dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded-xl text-slate-700 dark:text-slate-200 focus:ring-2 focus:ring-primary focus:border-transparent outline-none transition-all"
                                type="text" />
                        </div>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label
                                    class="block text-xs font-black uppercase tracking-widest text-slate-400 mb-2">Email
                                    Address</label>
                                <input id="info-email"
                                    class="w-full px-4 py-2.5 bg-slate-50 dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded-xl text-slate-700 dark:text-slate-200 focus:ring-2 focus:ring-primary focus:border-transparent outline-none transition-all"
                                    type="email" />
                            </div>
                            <div>
                                <label
                                    class="block text-xs font-black uppercase tracking-widest text-slate-400 mb-2">Phone
                                    Number</label>
                                <input id="info-phone"
                                    class="w-full px-4 py-2.5 bg-slate-50 dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded-xl text-slate-700 dark:text-slate-200 focus:ring-2 focus:ring-primary focus:border-transparent outline-none transition-all"
                                    type="tel" />
                            </div>
                        </div>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label
                                    class="block text-xs font-black uppercase tracking-widest text-slate-400 mb-2">LinkedIn
                                    URL</label>
                                <input id="info-linkedin"
                                    class="w-full px-4 py-2.5 bg-slate-50 dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded-xl text-slate-700 dark:text-slate-200 focus:ring-2 focus:ring-primary focus:border-transparent outline-none transition-all"
                                    type="text" placeholder="https://linkedin.com/in/..." />
                            </div>
                            <div>
                                <label
                                    class="block text-xs font-black uppercase tracking-widest text-slate-400 mb-2">Portfolio
                                    URL</label>
                                <input id="info-portfolio"
                                    class="w-full px-4 py-2.5 bg-slate-50 dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded-xl text-slate-700 dark:text-slate-200 focus:ring-2 focus:ring-primary focus:border-transparent outline-none transition-all"
                                    type="text" placeholder="https://your-portfolio.com" />
                            </div>
                        </div>
                        <div class="flex items-center justify-end gap-6 pt-4">
                            <button onclick="closeModal('modal-manage-info')"
                                class="text-slate-500 hover:text-slate-700 dark:hover:text-slate-300 font-bold text-sm transition-colors"
                                type="button">Cancel</button>
                            <button
                                class="px-8 py-3 bg-primary text-white font-bold rounded-xl shadow-lg shadow-primary/25 hover:bg-primary/90 transition-all text-sm"
                                type="submit">Save Changes</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <!-- Add Project Modal -->
        <div id="modal-add-project"
            class="hidden fixed inset-0 z-[100] flex items-center justify-center bg-slate-900/60 backdrop-blur-sm px-4">
            <div
                class="bg-white dark:bg-[#111418] w-full max-w-2xl rounded-2xl shadow-2xl overflow-hidden border border-slate-200 dark:border-slate-800">
                <div class="p-6 border-b border-slate-100 dark:border-slate-800 flex items-center justify-between">
                    <h2 class="text-xl font-bold text-slate-900 dark:text-white">Add New Project</h2>
                    <button onclick="closeModal('modal-add-project')" type="button"
                        class="text-slate-400 hover:text-slate-600 dark:hover:text-slate-200 transition-colors">
                        <span class="material-symbols-outlined">close</span>
                    </button>
                </div>
                <div class="p-8 space-y-6">
                    <form id="form-add-project" onsubmit="handleSaveProject(event)">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div class="space-y-2">
                                <label class="text-xs font-bold text-slate-400 uppercase tracking-widest">Project
                                    Title</label>
                                <input id="proj-title" required
                                    class="w-full px-4 py-3 rounded-xl border-slate-200 dark:border-slate-800 dark:bg-slate-900/50 focus:ring-primary focus:border-primary text-sm"
                                    placeholder="e.g. Autonomous Drone Navigation" type="text" />
                            </div>
                            <div class="space-y-2">
                                <label class="text-xs font-bold text-slate-400 uppercase tracking-widest">Role</label>
                                <input id="proj-role"
                                    class="w-full px-4 py-3 rounded-xl border-slate-200 dark:border-slate-800 dark:bg-slate-900/50 focus:ring-primary focus:border-primary text-sm"
                                    placeholder="e.g. Lead Developer" type="text" />
                            </div>
                        </div>
                        <div class="space-y-2 mt-6">
                            <label class="text-xs font-bold text-slate-400 uppercase tracking-widest">Duration</label>
                            <div class="flex items-center gap-4">
                                <input id="proj-start"
                                    class="flex-1 px-4 py-3 rounded-xl border-slate-200 dark:border-slate-800 dark:bg-slate-900/50 focus:ring-primary focus:border-primary text-sm"
                                    placeholder="Start (e.g. Jan 2024)" type="text" />
                                <span class="text-slate-400 font-bold">to</span>
                                <input id="proj-end"
                                    class="flex-1 px-4 py-3 rounded-xl border-slate-200 dark:border-slate-800 dark:bg-slate-900/50 focus:ring-primary focus:border-primary text-sm"
                                    placeholder="End (e.g. Present)" type="text" />
                            </div>
                        </div>
                        <div class="space-y-2 mt-6">
                            <label class="text-xs font-bold text-slate-400 uppercase tracking-widest">Project Link /
                                GitHub</label>
                            <input id="proj-link"
                                class="w-full px-4 py-3 rounded-xl border-slate-200 dark:border-slate-800 dark:bg-slate-900/50 focus:ring-primary focus:border-primary text-sm"
                                placeholder="https://github.com/..." type="url" />
                        </div>
                        <div class="space-y-2 mt-6">
                            <label
                                class="text-xs font-bold text-slate-400 uppercase tracking-widest">Description</label>
                            <textarea id="proj-desc"
                                class="w-full px-4 py-3 rounded-xl border-slate-200 dark:border-slate-800 dark:bg-slate-900/50 focus:ring-primary focus:border-primary text-sm"
                                rows="3"></textarea>
                        </div>
                        <div class="space-y-3 mt-6">
                            <label class="text-xs font-bold text-slate-400 uppercase tracking-widest">Tech Stack (Comma
                                separated)</label>
                            <input id="proj-tech"
                                class="w-full px-4 py-3 rounded-xl border-slate-200 dark:border-slate-800 dark:bg-slate-900/50 focus:ring-primary focus:border-primary text-sm"
                                placeholder="Python, TensorFlow, ROS" type="text" />
                        </div>
                        <div
                            class="p-6 mt-6 bg-slate-50 dark:bg-slate-900/50 border-t border-slate-100 dark:border-slate-800 flex justify-end gap-3">
                            <button onclick="closeModal('modal-add-project')" type="button"
                                class="px-6 py-2.5 text-sm font-bold text-slate-500 hover:text-slate-700 transition-colors">Cancel</button>
                            <button type="submit"
                                class="px-8 py-2.5 bg-primary text-white text-sm font-bold rounded-xl shadow-lg shadow-primary/25 hover:bg-primary/90 transition-all">Add
                                Project</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <!-- Add Skill Modal -->
        <div id="modal-add-skill"
            class="hidden fixed inset-0 z-[60] flex items-center justify-center p-4 bg-slate-900/40 backdrop-blur-sm">
            <div class="bg-white dark:bg-[#111418] w-full max-w-md rounded-2xl overflow-hidden shadow-2xl">
                <div class="bg-primary px-6 py-4 flex items-center justify-between">
                    <h3 class="text-white font-bold text-lg">Add New Skill</h3>
                    <button onclick="closeModal('modal-add-skill')"
                        class="text-white/80 hover:text-white transition-colors">
                        <span class="material-symbols-outlined text-[20px]">close</span>
                    </button>
                </div>
                <div class="p-6 space-y-6">
                    <div class="space-y-2">
                        <label class="text-[10px] text-slate-400 uppercase tracking-widest font-black block">Enter
                            Skill</label>
                        <input id="skill-input"
                            class="w-full px-4 py-3 bg-slate-50 border border-slate-200 rounded-xl text-sm focus:ring-2 focus:ring-primary/20 focus:border-primary outline-none"
                            placeholder="e.g. React, Java" type="text" />
                    </div>
                    <div class="flex flex-col sm:flex-row gap-3 pt-2">
                        <button onclick="handleSaveSkill()"
                            class="flex-1 px-6 py-3 bg-primary text-white text-sm font-bold rounded-xl shadow-lg shadow-primary/20 hover:bg-primary/90 transition-all">Add
                            to Profile</button>
                        <button onclick="closeModal('modal-add-skill')"
                            class="flex-1 px-6 py-3 bg-slate-100 text-slate-600 text-sm font-bold rounded-xl hover:bg-slate-200 transition-all">Cancel</button>
                    </div>
                </div>
            </div>
        </div>
        <!-- Manage Skills Modal -->
        <div id="modal-manage-skills"
            class="hidden fixed inset-0 z-[100] flex items-center justify-center p-4 bg-slate-900/60 backdrop-blur-sm">
            <div class="bg-white dark:bg-[#111418] w-full max-w-md rounded-2xl overflow-hidden shadow-2xl">
                <div class="bg-primary px-6 py-4 flex items-center justify-between">
                    <h3 class="text-white font-bold text-lg">Manage Skills</h3>
                    <button onclick="closeModal('modal-manage-skills')"
                        class="text-white/80 hover:text-white transition-colors">
                        <span class="material-symbols-outlined text-[20px]">close</span>
                    </button>
                </div>
                <div class="p-6">
                    <div id="manage-skills-list" class="flex flex-wrap gap-3">
                        <!-- Dynamic Skills Here -->
                    </div>
                </div>
            </div>
        </div>
    </main>
    <footer class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-10 text-center">
        <p class="text-slate-400 text-xs font-medium">Â© 2024 Placement AI. All rights reserved.</p>
    </footer>

    <script src="api.js?v=2"></script>
    <script src="nav.js"></script>
    <script>
        // State
        let currentUser = null;
        let currentProfileData = null;

        function closeModal(modalId) {
            document.getElementById(modalId).classList.add('hidden');
        }

        function openModal(modalId) {
            document.getElementById(modalId).classList.remove('hidden');
        }

        async function loadProfile() {
            const user = JSON.parse(localStorage.getItem('user'));
            if (!user) {
                window.location.href = 'studentlogin.html';
                return;
            }
            currentUser = user;

            try {
                const profile = await api.getStudentProfile(user._id);
                if (profile) {
                    currentProfileData = profile;

                    // Update Header Info
                    document.querySelector('h2.text-3xl').innerText = profile.name;

                    // Initial
                    const initial = profile.name ? profile.name.charAt(0).toUpperCase() : 'U';
                    const initialEl = document.getElementById('profile-initial');
                    if (initialEl) initialEl.innerText = initial;

                    // Personal Info Display
                    // Ensure we target the right elements. The structure:
                    // Grid > div > p.font-medium (Email)
                    // Grid > div > p.font-medium (Phone)
                    // Grid > div > a (LinkedIn)
                    // Grid > div > a (Portfolio)
                    const sets = document.querySelectorAll('.grid.grid-cols-1.md\\:grid-cols-2 > div');
                    if (sets.length >= 4) {
                        // Email
                        sets[0].querySelector('p.font-medium').innerText = profile.email || 'Not set';
                        // Phone
                        sets[1].querySelector('p.font-medium').innerText = profile.phone || 'Not set';
                        // LinkedIn
                        const liLink = sets[2].querySelector('a');
                        if (profile.linkedin) {
                            liLink.href = profile.linkedin;
                            liLink.innerHTML = `View Profile <span class="material-symbols-outlined text-xs">open_in_new</span>`;
                            liLink.classList.remove('text-slate-400');
                            liLink.classList.add('text-primary');
                        } else {
                            liLink.href = '#';
                            liLink.innerHTML = `Add LinkedIn <span class="material-symbols-outlined text-xs">add</span>`;
                            liLink.classList.add('text-slate-400');
                        }

                        // Portfolio
                        const portLink = sets[3].querySelector('a');
                        if (profile.portfolio) {
                            portLink.href = profile.portfolio;
                            portLink.innerHTML = `View Portfolio <span class="material-symbols-outlined text-xs">open_in_new</span>`;
                            portLink.classList.remove('text-slate-400');
                            portLink.classList.add('text-primary');
                        } else {
                            portLink.href = '#';
                            portLink.innerHTML = `Add Portfolio <span class="material-symbols-outlined text-xs">add</span>`;
                            portLink.classList.add('text-slate-400');
                        }
                    }

                    // Update CGPA
                    const cgpaText = document.querySelector('p.text-4xl.font-black');
                    const cgpaCircle = document.querySelectorAll('circle')[1];
                    if (cgpaText) cgpaText.innerText = profile.cgpa;
                    if (cgpaCircle) {
                        const offset = 440 * (1 - profile.cgpa / 10);
                        cgpaCircle.style.strokeDashoffset = offset;
                    }

                    // Update Skills
                    const skillContainer = document.querySelector('.flex.flex-wrap.gap-2.mb-6');
                    if (skillContainer) {
                        const skills = profile.skills || [];
                        skillContainer.innerHTML = skills.map(skill => `
                            <span class="px-3 py-1.5 bg-primary/10 text-primary border border-primary/20 rounded-lg text-xs font-bold">${skill}</span>
                        `).join('');
                    }

                    // Update Projects
                    const projectsContainer = document.getElementById('projects-container');
                    if (projectsContainer) {
                        projectsContainer.innerHTML = '';
                        if (profile.projects && profile.projects.length > 0) {
                            profile.projects.forEach(p => {
                                projectsContainer.insertAdjacentHTML('beforeend', createProjectCard(p));
                            });
                        } else {
                            projectsContainer.innerHTML = '<p class="text-slate-500 text-sm">No projects added yet. Click "Add New" to showcase your work.</p>';
                        }
                    }
                }
            } catch (err) {
                console.error("Error loading profile:", err);
            }
        }

        function createProjectCard(project) {
            return `
                <div class="border border-slate-100 dark:border-slate-800 rounded-2xl p-6 mt-4 relative group">
                    <div class="flex justify-between items-start mb-2">
                        <div>
                            <h4 class="text-xl font-bold text-slate-900 dark:text-white leading-tight">${project.title}</h4>
                            ${project.role ? `<p class="text-xs text-primary font-bold mt-1">${project.role}</p>` : ''}
                        </div>
                        <span class="text-[10px] text-slate-400 font-bold uppercase shrink-0 ml-4">${project.duration || 'Ongoing'}</span>
                    </div>
                    <p class="text-slate-600 dark:text-slate-400 mb-6 leading-relaxed text-sm">${project.description || ''}</p>
                    <div class="flex flex-wrap gap-2 mb-6">
                        ${project.techStack.map(tech => `
                            <span class="px-3 py-1 bg-slate-100 dark:bg-slate-800 rounded-full text-[10px] font-bold text-slate-600 dark:text-slate-400 uppercase tracking-wider">${tech}</span>
                        `).join('')}
                    </div>
                    <div>
                        <a class="text-xs font-bold text-primary flex items-center gap-1 hover:underline" href="${project.link}" target="_blank">
                            <span class="material-symbols-outlined text-[16px]">link</span> ${project.link ? 'GitHub / Link' : 'No Link'}
                        </a>
                    </div>
                </div>
            `;
        }

        // --- Event Handlers & Modal Logic ---

        // Manage Info
        document.getElementById('manage-btn').onclick = () => {
            if (!currentProfileData) return;
            document.getElementById('info-name').value = currentProfileData.name || '';
            document.getElementById('info-email').value = currentProfileData.email || '';
            document.getElementById('info-phone').value = currentProfileData.phone || '';
            document.getElementById('info-linkedin').value = currentProfileData.linkedin || '';
            document.getElementById('info-portfolio').value = currentProfileData.portfolio || '';
            openModal('modal-manage-info');
        };

        async function handleSaveInfo(e) {
            e.preventDefault();
            const name = document.getElementById('info-name').value;
            const email = document.getElementById('info-email').value;
            const phone = document.getElementById('info-phone').value;
            const linkedin = document.getElementById('info-linkedin').value;
            const portfolio = document.getElementById('info-portfolio').value;

            const updates = { name, email, phone, linkedin, portfolio };

            try {
                await api.updateStudentProfile(currentUser._id, updates);
                closeModal('modal-manage-info');
                loadProfile();
            } catch (err) {
                alert('Failed to update info');
                console.error(err);
            }
        }

        // Add Project
        document.getElementById('add-project-btn').onclick = () => {
            document.getElementById('form-add-project').reset();
            openModal('modal-add-project');
        };

        async function handleSaveProject(e) {
            e.preventDefault();
            const title = document.getElementById('proj-title').value;
            const role = document.getElementById('proj-role').value;
            const start = document.getElementById('proj-start').value;
            const end = document.getElementById('proj-end').value;
            const link = document.getElementById('proj-link').value;
            const desc = document.getElementById('proj-desc').value;
            const techStr = document.getElementById('proj-tech').value;

            const newProject = {
                title,
                role,
                duration: `${start} - ${end}`,
                link,
                description: desc,
                techStack: techStr.split(',').map(s => s.trim()).filter(s => s)
            };

            try {
                const profile = await api.getStudentProfile(currentUser._id);
                const updatedProjects = profile.projects ? [...profile.projects, newProject] : [newProject];

                await api.updateStudentProfile(currentUser._id, { projects: updatedProjects });
                closeModal('modal-add-project');
                loadProfile();
            } catch (err) {
                alert('Failed to add project');
                console.error(err);
            }
        }

        // Add Skill
        const btnAddSkill = document.getElementById('btn-add-skill');
        if (btnAddSkill) {
            btnAddSkill.onclick = () => {
                document.getElementById('skill-input').value = '';
                openModal('modal-add-skill');
            };
        }

        async function handleSaveSkill() {
            const skill = document.getElementById('skill-input').value.trim();
            if (!skill) return;

            try {
                const profile = await api.getStudentProfile(currentUser._id);
                const currentSkills = profile.skills || [];

                if (currentSkills.includes(skill)) {
                    alert('Skill already exists');
                    return;
                }
                const newSkills = [...currentSkills, skill];

                await api.updateStudentProfile(currentUser._id, { skills: newSkills });
                closeModal('modal-add-skill');
                loadProfile();
            } catch (err) {
                alert('Failed to add skill');
                console.error(err);
            }
        }

        // Manage Skills
        function openManageSkills() {
            if (!currentProfileData) return;
            const list = document.getElementById('manage-skills-list');
            list.innerHTML = '';

            const skills = currentProfileData.skills || [];

            if (skills.length === 0) {
                list.innerHTML = '<p class="text-slate-400 text-sm">No skills added yet.</p>';
            } else {
                skills.forEach(skill => {
                    const el = document.createElement('div');
                    el.className = 'px-3 py-1.5 bg-slate-100 dark:bg-slate-800 rounded-lg flex items-center gap-2 font-bold text-xs text-slate-700 dark:text-slate-300 border border-slate-200 dark:border-slate-700';

                    const textNode = document.createTextNode(skill);
                    el.appendChild(textNode);

                    const btn = document.createElement('button');
                    btn.className = 'text-slate-400 hover:text-red-500 transition-colors flex items-center ml-2';
                    btn.innerHTML = '<span class="material-symbols-outlined text-[16px]">remove_circle</span>';
                    btn.onclick = () => deleteSkill(skill, el);

                    el.appendChild(btn);
                    list.appendChild(el);
                });
            }
            openModal('modal-manage-skills');
        }

        async function deleteSkill(skill, elementToRemove) {
            // Optimistic Update: Remove element immediately
            if (elementToRemove) elementToRemove.remove();

            try {
                const profile = await api.getStudentProfile(currentUser._id);
                const currentSkills = profile.skills || [];
                const newSkills = currentSkills.filter(s => s !== skill);

                await api.updateStudentProfile(currentUser._id, { skills: newSkills });
                // Update local data and re-render the list without closing modal immediately, 
                // or just reload profile and re-render modal.
                // Re-rendering modal is better UX.
                currentProfileData.skills = newSkills;
                openManageSkills(); // Re-render list
                loadProfile(); // Update background UI
            } catch (err) {
                alert('Failed to remove skill');
                console.error(err);
            }
        }

        loadProfile();
    </script>
</body>

</html>